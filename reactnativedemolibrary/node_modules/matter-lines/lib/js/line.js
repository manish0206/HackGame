"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Line = function () {
  function Line() {
    var defaultPoints = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
    var lineWidth = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 10;
    var miterLimit = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 10;

    _classCallCheck(this, Line);

    this.points = defaultPoints;
    this.outsidePoints = [];
    this.insidePoints = [];
    this.lineWidth = lineWidth;
    this.miterLimit = miterLimit;

    if (this.points.length > 0) {
      this.calculatePoints();
    }
  }

  _createClass(Line, [{
    key: "clear",
    value: function clear() {
      this.points = [];
      this.outsidePoints = [];
      this.insidePoints = [];
    }
  }, {
    key: "addPoint",
    value: function addPoint(point) {
      this.points.push(point);
      this.calculatePoints();
    }
  }, {
    key: "calculatePoints",
    value: function calculatePoints() {
      this.outsidePoints = [];
      this.insidePoints = [];
      if (this.points.length <= 1) return;
      for (var index = 0; index < this.points.length; index++) {
        if (index === 0) {
          this.calculateFirstPoint(index);
        } else if (index === this.points.length - 1) {
          this.calculateLastPoint(index);
        } else {
          this.calculateMiddlePoint(index);
        }
      }
    }
  }, {
    key: "calculateFirstPoint",
    value: function calculateFirstPoint(index) {
      var point = this.points[index];
      var afterPoint = this.points[index + 1];
      var rad = Math.atan2(afterPoint.y - point.y, afterPoint.x - point.x) - Math.PI / 2;
      var sin = Math.sin(rad) * this.lineWidth;
      var cos = Math.cos(rad) * this.lineWidth;
      this.outsidePoints.push({ x: point.x + cos, y: point.y + sin });
      this.insidePoints.push({ x: point.x - cos, y: point.y - sin });
    }
  }, {
    key: "calculateLastPoint",
    value: function calculateLastPoint(index) {
      var point = this.points[index];
      var beforePoint = this.points[index];
      var rad = Math.atan2(this.points[index - 1].y - point.y, this.points[index - 1].x - point.x) + Math.PI / 2;
      var sin = Math.sin(rad) * this.lineWidth;
      var cos = Math.cos(rad) * this.lineWidth;
      this.outsidePoints.push({ x: point.x + cos, y: point.y + sin });
      this.insidePoints.push({ x: point.x - cos, y: point.y - sin });
    }
  }, {
    key: "calculateMiddlePoint",
    value: function calculateMiddlePoint(index) {
      var point = this.points[index];
      var rad1 = Math.atan2(this.points[index - 1].y - point.y, this.points[index - 1].x - point.x);
      var rad2 = Math.atan2(this.points[index + 1].y - point.y, this.points[index + 1].x - point.x);
      // rad1 = 0° にした、二等分線になっている
      var rad = (rad2 - rad1) / 2;
      var x = Math.cos(rad) * this.lineWidth / Math.sin(rad);
      var y = this.lineWidth;
      var distance = getDistance({ x: 0, y: 0 }, { x: x, y: y });
      // 回転移動させる
      var rx = x * Math.cos(rad1) - y * Math.sin(rad1);
      var ry = x * Math.sin(rad1) + y * Math.cos(rad1);
      rad1 -= Math.PI / 2;
      rad2 += Math.PI / 2;
      if (distance > this.miterLimit && x < 0) {
        this.outsidePoints.push({ x: point.x - Math.cos(rad1) * this.lineWidth, y: point.y - Math.sin(rad1) * this.lineWidth });
        this.outsidePoints.push({ x: point.x - Math.cos(rad2) * this.lineWidth, y: point.y - Math.sin(rad2) * this.lineWidth });
      } else {
        this.outsidePoints.push({ x: point.x + rx, y: point.y + ry });
      }
      if (distance > this.miterLimit && x >= 0) {
        this.insidePoints.push({ x: point.x + Math.cos(rad1) * this.lineWidth, y: point.y + Math.sin(rad1) * this.lineWidth });
        this.insidePoints.push({ x: point.x + Math.cos(rad2) * this.lineWidth, y: point.y + Math.sin(rad2) * this.lineWidth });
      } else {
        this.insidePoints.push({ x: point.x - rx, y: point.y - ry });
      }
    }
  }, {
    key: "getVertices",
    value: function getVertices() {
      var vertices = this.outsidePoints.concat(this.insidePoints.reverse());
      this.insidePoints.reverse();
      return vertices;
    }
  }]);

  return Line;
}();

exports.default = Line;


function getDistance(point1, point2) {
  // 三平方の定理
  var a = Math.abs(point1.x - point2.x);
  var b = Math.abs(point1.y - point2.y);
  return Math.sqrt(a * a + b * b);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2pzL2xpbmUuanMiXSwibmFtZXMiOlsiTGluZSIsImRlZmF1bHRQb2ludHMiLCJsaW5lV2lkdGgiLCJtaXRlckxpbWl0IiwicG9pbnRzIiwib3V0c2lkZVBvaW50cyIsImluc2lkZVBvaW50cyIsImxlbmd0aCIsImNhbGN1bGF0ZVBvaW50cyIsInBvaW50IiwicHVzaCIsImluZGV4IiwiY2FsY3VsYXRlRmlyc3RQb2ludCIsImNhbGN1bGF0ZUxhc3RQb2ludCIsImNhbGN1bGF0ZU1pZGRsZVBvaW50IiwiYWZ0ZXJQb2ludCIsInJhZCIsIk1hdGgiLCJhdGFuMiIsInkiLCJ4IiwiUEkiLCJzaW4iLCJjb3MiLCJiZWZvcmVQb2ludCIsInJhZDEiLCJyYWQyIiwiZGlzdGFuY2UiLCJnZXREaXN0YW5jZSIsInJ4IiwicnkiLCJ2ZXJ0aWNlcyIsImNvbmNhdCIsInJldmVyc2UiLCJwb2ludDEiLCJwb2ludDIiLCJhIiwiYWJzIiwiYiIsInNxcnQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7SUFBcUJBLEk7QUFDbkIsa0JBQWlFO0FBQUEsUUFBckRDLGFBQXFELHVFQUFyQyxFQUFxQztBQUFBLFFBQWpDQyxTQUFpQyx1RUFBckIsRUFBcUI7QUFBQSxRQUFqQkMsVUFBaUIsdUVBQUosRUFBSTs7QUFBQTs7QUFDL0QsU0FBS0MsTUFBTCxHQUFjSCxhQUFkO0FBQ0EsU0FBS0ksYUFBTCxHQUFxQixFQUFyQjtBQUNBLFNBQUtDLFlBQUwsR0FBb0IsRUFBcEI7QUFDQSxTQUFLSixTQUFMLEdBQWlCQSxTQUFqQjtBQUNBLFNBQUtDLFVBQUwsR0FBa0JBLFVBQWxCOztBQUVBLFFBQUksS0FBS0MsTUFBTCxDQUFZRyxNQUFaLEdBQXFCLENBQXpCLEVBQTRCO0FBQzFCLFdBQUtDLGVBQUw7QUFDRDtBQUNGOzs7OzRCQUNPO0FBQ04sV0FBS0osTUFBTCxHQUFjLEVBQWQ7QUFDQSxXQUFLQyxhQUFMLEdBQXFCLEVBQXJCO0FBQ0EsV0FBS0MsWUFBTCxHQUFvQixFQUFw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dkI7QUFDRCxPQUhELE1BR087QUFDTCxhQUFLSSxZQUFMLENBQWtCSSxJQUFsQixDQUF1QixFQUFFVSxHQUFHWCxNQUFNVyxDQUFOLEdBQVVTLEVBQWYsRUFBbUJWLEdBQUdWLE1BQU1VLENBQU4sR0FBVVcsRUFBaEMsRUFBdkI7QUFDRDtBQUNGOzs7a0NBQ2E7QUFDWixVQUFNQyxXQUFXLEtBQUsxQixhQUFMLENBQW1CMkIsTUFBbkIsQ0FBMEIsS0FBSzFCLFlBQUwsQ0FBa0IyQixPQUFsQixFQUExQixDQUFqQjtBQUNBLFdBQUszQixZQUFMLENBQWtCMkIsT0FBbEI7QUFDQSxhQUFPRixRQUFQO0FBQ0Q7Ozs7OztrQkF0RmtCL0IsSTs7O0FBeUZyQixTQUFTNEIsV0FBVCxDQUFxQk0sTUFBckIsRUFBNkJDLE1BQTdCLEVBQXFDO0FBQ25DO0FBQ0EsTUFBTUMsSUFBSW5CLEtBQUtvQixHQUFMLENBQVNILE9BQU9kLENBQVAsR0FBV2UsT0FBT2YsQ0FBM0IsQ0FBVjtBQUNBLE1BQU1rQixJQUFJckIsS0FBS29CLEdBQUwsQ0FBU0gsT0FBT2YsQ0FBUCxHQUFXZ0IsT0FBT2hCLENBQTNCLENBQVY7QUFDQSxTQUFPRixLQUFLc0IsSUFBTCxDQUFVSCxJQUFJQSxDQUFKLEdBQVFFLElBQUlBLENBQXRCLENBQVA7QUFDRCIsImZpbGUiOiJsaW5lLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgY2xhc3MgTGluZSB7XHJcbiAgY29uc3RydWN0b3IoZGVmYXVsdFBvaW50cyA9IFtdLCBsaW5lV2lkdGggPSAxMCwgbWl0ZXJMaW1pdCA9IDEwKSB7XHJcbiAgICB0aGlzLnBvaW50cyA9IGRlZmF1bHRQb2ludHM7XHJcbiAgICB0aGlzLm91dHNpZGVQb2ludHMgPSBbXTtcclxuICAgIHRoaXMuaW5zaWRlUG9pbnRzID0gW107XHJcbiAgICB0aGlzLmxpbmVXaWR0aCA9IGxpbmVXaWR0aDtcclxuICAgIHRoaXMubWl0ZXJMaW1pdCA9IG1pdGVyTGltaXQ7XHJcblxyXG4gICAgaWYgKHRoaXMucG9pbnRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgdGhpcy5jYWxjdWxhdGVQb2ludHMoKTtcclxuICAgIH1cclxuICB9XHJcbiAgY2xlYXIoKSB7XHJcbiAgICB0aGlzLnBvaW50cyA9IFtdO1xyXG4gICAgdGhpcy5vdXRzaWRlUG9pbnRzID0gW107XHJcbiAgICB0aGlzLmluc2lkZVBvaW50cyA9IFtdO1xyXG4gIH1cclxuICBhZGRQb2ludChwb2ludCkge1xyXG4gICAgdGhpcy5wb2ludHMucHVzaChwb2ludCk7XHJcbiAgICB0aGlzLmNhbGN1bGF0ZVBvaW50cygpO1xyXG4gIH1cclxuICBjYWxjdWxhdGVQb2ludHMoKSB7XHJcbiAgICB0aGlzLm91dHNpZGVQb2ludHMgPSBbXTtcclxuICAgIHRoaXMuaW5zaWRlUG9pbnRzID0gW107XHJcbiAgICBpZiAodGhpcy5wb2ludHMubGVuZ3RoIDw9IDEpIHJldHVybjtcclxuICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB0aGlzLnBvaW50cy5sZW5ndGg7IGluZGV4KyspIHtcclxuICAgICAgaWYgKGluZGV4ID09PSAwKSB7XHJcbiAgICAgICAgdGhpcy5jYWxjdWxhdGVGaXJzdFBvaW50KGluZGV4KTtcclxuICAgICAgfSBlbHNlIGlmIChpbmRleCA9PT0gdGhpcy5wb2ludHMubGVuZ3RoIC0gMSkge1xyXG4gICAgICAgIHRoaXMuY2FsY3VsYXRlTGFzdFBvaW50KGluZGV4KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLmNhbGN1bGF0ZU1pZGRsZVBvaW50KGluZGV4KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICBjYWxjdWxhdGVGaXJzdFBvaW50KGluZGV4KSB7XHJcbiAgICBjb25zdCBwb2ludCA9IHRoaXMucG9pbnRzW2luZGV4XTtcclxuICAgIGNvbnN0IGFmdGVyUG9pbnQgPSB0aGlzLnBvaW50c1tpbmRleCArIDFdO1xyXG4gICAgY29uc3QgcmFkID1cclxuICAgICAgTWF0aC5hdGFuMihhZnRlclBvaW50LnkgLSBwb2ludC55LCBhZnRlclBvaW50LnggLSBwb2ludC54KSAtIE1hdGguUEkgLyAyO1xyXG4gICAgY29uc3Qgc2luID0gTWF0aC5zaW4ocmFkKSAqIHRoaXMubGluZVdpZHRoO1xyXG4gICAgY29uc3QgY29zID0gTWF0aC5jb3MocmFkKSAqIHRoaXMubGluZVdpZHRoO1xyXG4gICAgdGhpcy5vdXRzaWRlUG9pbnRzLnB1c2goeyB4OiBwb2ludC54ICsgY29zLCB5OiBwb2ludC55ICsgc2luIH0pO1xyXG4gICAgdGhpcy5pbnNpZGVQb2ludHMucHVzaCh7IHg6IHBvaW50LnggLSBjb3MsIHk6IHBvaW50LnkgLSBzaW4gfSk7XHJcbiAgfVxyXG4gIGNhbGN1bGF0ZUxhc3RQb2ludChpbmRleCkge1xyXG4gICAgY29uc3QgcG9pbnQgPSB0aGlzLnBvaW50c1tpbmRleF07XHJcbiAgICBjb25zdCBiZWZvcmVQb2ludCA9IHRoaXMucG9pbnRzW2luZGV4XTtcclxuICAgIGNvbnN0IHJhZCA9XHJcbiAgICAgIE1hdGguYXRhbjIodGhpcy5wb2ludHNbaW5kZXggLSAxXS55IC0gcG9pbnQueSwgdGhpcy5wb2ludHNbaW5kZXggLSAxXS54IC0gcG9pbnQueCkgKyBNYXRoLlBJIC8gMjtcclxuICAgIGNvbnN0IHNpbiA9IE1hdGguc2luKHJhZCkgKiB0aGlzLmxpbmVXaWR0aDtcclxuICAgIGNvbnN0IGNvcyA9IE1hdGguY29zKHJhZCkgKiB0aGlzLmxpbmVXaWR0aDtcclxuICAgIHRoaXMub3V0c2lkZVBvaW50cy5wdXNoKHsgeDogcG9pbnQueCArIGNvcywgeTogcG9pbnQueSArIHNpbiB9KTtcclxuICAgIHRoaXMuaW5zaWRlUG9pbnRzLnB1c2goeyB4OiBwb2ludC54IC0gY29zLCB5OiBwb2ludC55IC0gc2luIH0pO1xyXG4gIH1cclxuICBjYWxjdWxhdGVNaWRkbGVQb2ludChpbmRleCkge1xyXG4gICAgY29uc3QgcG9pbnQgPSB0aGlzLnBvaW50c1tpbmRleF07XHJcbiAgICBsZXQgcmFkMSA9IE1hdGguYXRhbjIodGhpcy5wb2ludHNbaW5kZXggLSAxXS55IC0gcG9pbnQueSwgdGhpcy5wb2ludHNbaW5kZXggLSAxXS54IC0gcG9pbnQueCk7XHJcbiAgICBsZXQgcmFkMiA9IE1hdGguYXRhbjIodGhpcy5wb2ludHNbaW5kZXggKyAxXS55IC0gcG9pbnQueSwgdGhpcy5wb2ludHNbaW5kZXggKyAxXS54IC0gcG9pbnQueCk7XHJcbiAgICAvLyByYWQxID0gMMKwIOOBq+OBl+OBn+OAgeS6jOetieWIhue3muOBq+OBquOBo+OBpuOBhOOCi1xyXG4gICAgY29uc3QgcmFkID0gKHJhZDIgLSByYWQxKSAvIDI7XHJcbiAgICBjb25zdCB4ID0gTWF0aC5jb3MocmFkKSAqIHRoaXMubGluZVdpZHRoIC8gTWF0aC5zaW4ocmFkKTtcclxuICAgIGNvbnN0IHkgPSB0aGlzLmxpbmVXaWR0aDtcclxuICAgIGNvbnN0IGRpc3RhbmNlID0gZ2V0RGlzdGFuY2UoeyB4OiAwLCB5OiAwIH0sIHsgeCwgeSB9KTtcclxuICAgIC8vIOWbnui7ouenu+WLleOBleOBm+OCi1xyXG4gICAgY29uc3QgcnggPSB4ICogTWF0aC5jb3MocmFkMSkgLSB5ICogTWF0aC5zaW4ocmFkMSk7XHJcbiAgICBjb25zdCByeSA9IHggKiBNYXRoLnNpbihyYWQxKSArIHkgKiBNYXRoLmNvcyhyYWQxKTtcclxuICAgIHJhZDEgLT0gTWF0aC5QSSAvIDI7XHJcbiAgICByYWQyICs9IE1hdGguUEkgLyAyO1xyXG4gICAgaWYgKGRpc3RhbmNlID4gdGhpcy5taXRlckxpbWl0ICYmIHggPCAwKSB7XHJcbiAgICAgIHRoaXMub3V0c2lkZVBvaW50cy5wdXNoKHsgeDogcG9pbnQueCAtIE1hdGguY29zKHJhZDEpICogdGhpcy5saW5lV2lkdGgsIHk6IHBvaW50LnkgLSBNYXRoLnNpbihyYWQxKSAqIHRoaXMubGluZVdpZHRoIH0pO1xyXG4gICAgICB0aGlzLm91dHNpZGVQb2ludHMucHVzaCh7IHg6IHBvaW50LnggLSBNYXRoLmNvcyhyYWQyKSAqIHRoaXMubGluZVdpZHRoLCB5OiBwb2ludC55IC0gTWF0aC5zaW4ocmFkMikgKiB0aGlzLmxpbmVXaWR0aCB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMub3V0c2lkZVBvaW50cy5wdXNoKHsgeDogcG9pbnQueCArIHJ4LCB5OiBwb2ludC55ICsgcnkgfSk7XHJcbiAgICB9XHJcbiAgICBpZiAoZGlzdGFuY2UgPiB0aGlzLm1pdGVyTGltaXQgJiYgeCA+PSAwKSB7XHJcbiAgICAgIHRoaXMuaW5zaWRlUG9pbnRzLnB1c2goeyB4OiBwb2ludC54ICsgTWF0aC5jb3MocmFkMSkgKiB0aGlzLmxpbmVXaWR0aCwgeTogcG9pbnQueSArIE1hdGguc2luKHJhZDEpICogdGhpcy5saW5lV2lkdGggfSk7XHJcbiAgICAgIHRoaXMuaW5zaWRlUG9pbnRzLnB1c2goeyB4OiBwb2ludC54ICsgTWF0aC5jb3MocmFkMikgKiB0aGlzLmxpbmVXaWR0aCwgeTogcG9pbnQueSArIE1hdGguc2luKHJhZDIpICogdGhpcy5saW5lV2lkdGggfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmluc2lkZVBvaW50cy5wdXNoKHsgeDogcG9pbnQueCAtIHJ4LCB5OiBwb2ludC55IC0gcnkgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGdldFZlcnRpY2VzKCkge1xyXG4gICAgY29uc3QgdmVydGljZXMgPSB0aGlzLm91dHNpZGVQb2ludHMuY29uY2F0KHRoaXMuaW5zaWRlUG9pbnRzLnJldmVyc2UoKSk7XHJcbiAgICB0aGlzLmluc2lkZVBvaW50cy5yZXZlcnNlKCk7XHJcbiAgICByZXR1cm4gdmVydGljZXM7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBnZXREaXN0YW5jZShwb2ludDEsIHBvaW50Mikge1xyXG4gIC8vIOS4ieW5s+aWueOBruWumueQhlxyXG4gIGNvbnN0IGEgPSBNYXRoLmFicyhwb2ludDEueCAtIHBvaW50Mi54KTtcclxuICBjb25zdCBiID0gTWF0aC5hYnMocG9pbnQxLnkgLSBwb2ludDIueSk7XHJcbiAgcmV0dXJuIE1hdGguc3FydChhICogYSArIGIgKiBiKTtcclxufSJdfQ==